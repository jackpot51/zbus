import * as assert from "node:assert";

let gimojis;
try {
    const res = await fetch(
        "https://raw.githubusercontent.com/zeenix/gimoji/refs/heads/main/emojis.json",
    );
    assert.ok(res.ok);
    const json = await res.json();
    gimojis = json.gitmojis.map(({ emoji }) => emoji);
} catch (cause) {
    throw new Error("unable to fetch gimoji emojis.json", { cause });
}

export default {
    defaultIgnores: true,
    helpUrl: "https://github.com/z-galaxy/zbus/blob/main/CONTRIBUTING.md",
    ignores: [
        (commit) =>
            commit.includes(
                "This PR was generated by [Mend Renovate](https://mend.io/renovate/).",
            ),
    ],
    plugins: [
        {
            rules: {
                "start-with-gimoji": ({ header }) => {
                    return [
                        gimojis.some((symbol) => header.startsWith(symbol)),
                        "commit message must begin with a Unicode emoji from https://zeenix.github.io/gimoji/",
                    ];
                },
            },
        },
    ],
    rules: {
        "body-max-line-length": [1, "always", 75],
        "header-max-length": [2, "always", 72],
        "start-with-gimoji": [2, "always"],
    },
};
